<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Youtube-js-implementation by Mesure-Mediametrie</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Youtube-js-implementation</h1>
      <h2 class="project-tagline">example of how to integrate a JS beacon with a Youtube player</h2>
      <a href="https://github.com/Mesure-Mediametrie/youtube-JS-implementation" class="btn">View on GitHub</a>
      <a href="https://github.com/Mesure-Mediametrie/youtube-JS-implementation/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Mesure-Mediametrie/youtube-JS-implementation/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h3>
      <a id="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Welcome to GitHub Pages.</h3>

      <p>This automatic page generator is the easiest way to create beautiful pages for all of your projects. Author your page content here <a href="https://guides.github.com/features/mastering-markdown/">using GitHub Flavored Markdown</a>, select a template crafted by a designer, and publish. After your page is generated, you can check out the new <code>gh-pages</code> branch locally. If you’re using GitHub Desktop, simply sync your repository and you’ll see the new branch.</p>


<!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <div id="player"></div>

    <script>
      // 2. This code loads the IFrame Player API code asynchronously.

      var confStreamingAnalytics;
      var streamTag;

      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // 3. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      var player;


      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '390',
          width: '640',
          videoId: 'M7lc1UVf-VE',
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }


      // 4. The API will call this function when the video player is ready.
      function onPlayerReady(event) {
        // This code loads the MM JS code asynchronously.
        var eS = document.createElement('script');
        eS.type = 'text/javascript';
        eS.async = true;
        eS.src = '//prof.estat.com/js/mu-5.1.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(eS, s);
        // 4. Envoi de la mesure
        if(eS.addEventListener) { // for all browsers except old IEs (< 9)
          eS.addEventListener('load', function(){
            eSloaded();
          }, false)
        } else { // for old IEs only
          eS.onreadystatechange = function () {
            if (eS.readyState in {complete: 1, loaded: 1}) {
              eSloaded();
            }
          };
        }
        
        console.log("PLAYER : ");
        console.log(player);

        // Configure the measure object
        confStreamingAnalytics = {
          serial: 241041208720,
          measure: "streaming",
          streaming: {
            playerObj: player,
            diffusion: "replay",
            callbackPosition: getTimerDisplay,
            playerName: "player",
            streamName: player.getVideoData().title,
            streamDuration: player.getDuration()
          },
          levels: {
            level_1: "Film",
            level_2: "CinÃ©ma"
          }
        };
      }

      eSloaded = function(){
        streamTag = new eStatTag(confStreamingAnalytics);
      };

      var getTimerDisplay = function (player) {
        // Update current time text display.
        videoPosition = Math.round(player.getCurrentTime());
        return videoPosition;
    }

      // 5. The API calls this function when the player's state changes.
      function onPlayerStateChange(event) {
        switch (event.data) {
          case YT.PlayerState.PLAYING:
            streamTag.notifyPlayer('play');
                    console.log(player);        
        console.log(Math.round(player.getCurrentTime()));
            break;
          case YT.PlayerState.PAUSED:
            streamTag.notifyPlayer('pause');
                    console.log(player);        
        console.log(Math.round(player.getCurrentTime()));
            break;
          case YT.PlayerState.BUFFERING:
            streamTag.notifyPlayer('pause');
            break;
          /*case YT.PlayerState.CUED:
            console.log(event.target.eventTag);
            console.log(event);
            break;*/
          case YT.PlayerState.ENDED:
            streamTag.notifyPlayer('stop');
            break;
        }
      }

 
    </script>



      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/Mesure-Mediametrie/youtube-JS-implementation">Youtube-js-implementation</a> is maintained by <a href="https://github.com/Mesure-Mediametrie">Mesure-Mediametrie</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
